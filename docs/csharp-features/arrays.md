# Arrays

Array type is a special kind of type reference and is represented by `Coberec.ExprCS.ArrayType` record. It is member of `TypeReference` union and you can use it probably anywhere `TypeReference` is expected.

### Creating arrays

Array is created using `Coberec.ExprCS.Expression.NewArray` expression. For example, expression `new int[55]` can be generated by:

```csharp
Expression.NewArray(
    new ArrayType(TypeSignature.Int32, dimensions: 1),
    Expression.Constant(55)
)
```

Multidimensional array are created using the same method, just with more dimensions. `new int[1, 2, 3, 4, 5]` would be:

```csharp
Expression.NewArray(
    new ArrayType(TypeSignature.Int32, dimensions: 5),
    Expression.Constant(1),
    Expression.Constant(2),
    Expression.Constant(3),
    Expression.Constant(4),
    Expression.Constant(5)
)
```

### Accessing elements

Elements of a array are accessed using `Coberec.ExprCS.Expression.ArrayIndex` expression. Rather than having two different expression for reading and writing array elements, the `ArrayIndex` expression returns a reference that can be either dereferences (read) or assigned to (written to).

Reading an array element (`a[13]`):

```csharp
Expression.ArrayIndex(
    a,
    Expression.Constant(13)
).Dereference();
```

Writing an array element (`a[13] = "abc"`):

```csharp
Expression.ArrayIndex(
    a,
    Expression.Constant(13)
).ReferenceAssign(Expression.Constant("abc"));
```

### Initializing arrays

As equivalent to the C# array initialization feature, we offer a `Coberec.ExprCS.ExpressionFactory.MakeArray` method. It simply creates an array with the specified elements. For example, equivalent of `new [] { 1, 2 }` is:

```csharp
ExpressionFactory.MakeArray(
    Expression.Constant(1),
    Expression.Constant(2)
)
```

The items must have the same type, no implicit conversions are performed (as usual). As in C#, this does not work when the number of items is zero since the return type can't be inferred. You can create empty arrays using the `NewArray` function showed above or be explicit about the result type.


```csharp
string[] values = LoadValues(); // we are not sure about the count - it may be zero. But we know the type
Expression array = ExpressionFactory.MakeArray(
    TypeSignature.String,
    values.Select(Expression.Constant)
)
```
